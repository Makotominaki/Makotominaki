local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- GUI Container
local screenGui = Instance.new("ScreenGui", playerGui)
screenGui.Name = "NHUBGui"
screenGui.ResetOnSpawn = false

-- Toggle Button
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"
toggleButton.Parent = screenGui
toggleButton.Text = "NHUB DEAD RAILS"
toggleButton.Size = UDim2.new(0, 160, 0, 40)
toggleButton.Position = UDim2.new(1, -180, 0, 20)
toggleButton.BackgroundColor3 = Color3.fromRGB(40, 0, 0)
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 14
toggleButton.BorderSizePixel = 0

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainMenu"
mainFrame.Parent = screenGui
mainFrame.Size = UDim2.new(0, 300, 1, 0)
mainFrame.Position = UDim2.new(0, -300, 0, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 0, 0)
mainFrame.BorderSizePixel = 0

-- Scrollable
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Parent = mainFrame
scrollFrame.Size = UDim2.new(1, 0, 1, 0)
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollFrame.ScrollBarThickness = 8
scrollFrame.BackgroundTransparency = 1
scrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y

local layout = Instance.new("UIListLayout", scrollFrame)
layout.Padding = UDim.new(0, 8)
layout.SortOrder = Enum.SortOrder.LayoutOrder

-- Helper Functions
local function createSectionHeader(text)
	local header = Instance.new("TextLabel")
	header.Size = UDim2.new(1, -20, 0, 30)
	header.Position = UDim2.new(0, 10, 0, 0)
	header.BackgroundTransparency = 1
	header.Text = "[ " .. text .. " ]"
	header.TextColor3 = Color3.fromRGB(255, 50, 50)
	header.Font = Enum.Font.GothamBold
	header.TextSize = 16
	header.TextXAlignment = Enum.TextXAlignment.Left
	header.Parent = scrollFrame
	return header
end

local function createButton(text, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, -20, 0, 40)
	btn.Position = UDim2.new(0, 10, 0, 0)
	btn.BackgroundColor3 = Color3.fromRGB(60, 0, 0)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Text = text
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 14
	btn.BorderSizePixel = 0
	btn.Parent = scrollFrame
	if callback then
		btn.MouseButton1Click:Connect(function()
			callback(btn)
		end)
	end
	return btn
end

-- === Sections ===
createSectionHeader("CLASS SELECTION")
createButton("คลาสม้า", function()
	ReplicatedStorage.Shared.RemotePromise.Remotes.C_EquipClass:FireServer("Horse")
end)
createButton("คลาสไข่", function()
	ReplicatedStorage.Shared.RemotePromise.Remotes.C_EquipClass:FireServer("Eggslinger")
end)

-- === เปลี่ยนคลาส ===
createSectionHeader("เปลี่ยนคลาส")

local classList = {
    "Musician",
    "Doctor",
    "Miner",
    "Arsonist",
    "Packmaster",
    "Necromancer",
    "Werewolf",
    "HighRoller",
    "Conductor",
    "Cowboy",
    "Alamo",
    "Zombie",
    -- ถ้ามีต่อท้าย V... ตัดมาเพิ่มได้
}

for _, className in ipairs(classList) do
    createButton("คลาส: " .. className, function()
        local args = {
            [1] = className
        }
        ReplicatedStorage:WaitForChild("Shared"):WaitForChild("RemotePromise"):WaitForChild("Remotes"):WaitForChild("C_EquipClass"):FireServer(unpack(args))
    end)
end

createSectionHeader("PLAYER SETTINGS")
-- BOT LOCK
local npcLock = false
local toggleLoop
local lastTarget = nil
local camera = workspace.CurrentCamera

local function addPlayerHighlight()
    if player.Character then
        local highlight = player.Character:FindFirstChild("PlayerHighlightESP")
        if not highlight then
            highlight = Instance.new("Highlight")
            highlight.Name = "PlayerHighlightESP"
            highlight.FillColor = Color3.new(1, 1, 1)
            highlight.OutlineColor = Color3.new(1, 1, 1)
            highlight.FillTransparency = 0.5
            highlight.OutlineTransparency = 0
            highlight.Parent = player.Character
        end
    end
end

local function removePlayerHighlight()
    if player.Character and player.Character:FindFirstChild("PlayerHighlightESP") then
        player.Character.PlayerHighlightESP:Destroy()
    end
end

local function getClosestNPC()
    local closestNPC = nil
    local closestDistance = math.huge

    for _, object in ipairs(workspace:GetDescendants()) do
        if object:IsA("Model") then
            local humanoid = object:FindFirstChild("Humanoid") or object:FindFirstChildWhichIsA("Humanoid")
            local hrp = object:FindFirstChild("HumanoidRootPart") or object.PrimaryPart
            if humanoid and hrp and humanoid.Health > 0 and object.Name ~= "Horse" then
                local isPlayer = false
                for _, pl in ipairs(Players:GetPlayers()) do
                    if pl.Character == object then
                        isPlayer = true
                        break
                    end
                end
                if not isPlayer then
                    local distance = (hrp.Position - player.Character.HumanoidRootPart.Position).Magnitude
                    if distance < closestDistance then
                        closestDistance = distance
                        closestNPC = object
                    end
                end
            end
        end
    end

    return closestNPC
end

createButton("ล็อกบอท: ปิด", function(btn)
    npcLock = not npcLock
    btn.Text = "ล็อกบอท: " .. (npcLock and "เปิด" or "ปิด")

    if npcLock then
        toggleLoop = RunService.RenderStepped:Connect(function()
            local npc = getClosestNPC()
            if npc and npc:FindFirstChild("Humanoid") then
                local npcHumanoid = npc:FindFirstChild("Humanoid")
                if npcHumanoid.Health > 0 then
                    camera.CameraSubject = npcHumanoid
                    lastTarget = npc
                    addPlayerHighlight()
                else
                    StarterGui:SetCore("SendNotification", {
                        Title = "กำจัดบอทแล้ว",
                        Text = npc.Name,
                        Duration = 0.4
                    })
                    lastTarget = nil
                    removePlayerHighlight()
                    if player.Character and player.Character:FindFirstChild("Humanoid") then
                        camera.CameraSubject = player.Character:FindFirstChild("Humanoid")
                    end
                end
            else
                if player.Character and player.Character:FindFirstChild("Humanoid") then
                    camera.CameraSubject = player.Character:FindFirstChild("Humanoid")
                end
                lastTarget = nil
                removePlayerHighlight()
            end
        end)
    else
        if toggleLoop then
            toggleLoop:Disconnect()
            toggleLoop = nil
        end
        removePlayerHighlight()
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            camera.CameraSubject = player.Character:FindFirstChild("Humanoid")
        end
    end
end)

-- === เก็บไข่อัตโนมัติ ===
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("StoreItem")
local eggNames = {"SmallEgg", "MediumEgg", "LargeEgg"}

local autoEggAndSackEnabled = false
local sackDistance = 25

createButton("เก็บไข่อัตโนมัติ", function(btn)
	autoEggAndSackEnabled = not autoEggAndSackEnabled
	btn.Text = "เก็บไข่อัตโนมัติ" .. (autoEggAndSackEnabled and " (เปิด)" or " (ปิด)")

	if autoEggAndSackEnabled then
		task.spawn(function()
			while autoEggAndSackEnabled do
				local character = player.Character
				local hrp = character and character:FindFirstChild("HumanoidRootPart")
				local backpack = player:FindFirstChildOfClass("Backpack")
				local sack = backpack and backpack:FindFirstChild("Sack")

				-- ถือ Sack อัตโนมัติเมื่อใกล้ไข่
				if hrp and sack then
					for _, obj in ipairs(workspace:GetDescendants()) do
						if obj:IsA("Model") and table.find(eggNames, obj.Name) then
							local part = obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart")
							if part and (part.Position - hrp.Position).Magnitude <= sackDistance then
								sack.Parent = character
								break
							end
						end
					end
				end

				-- เก็บไข่อัตโนมัติ
				for _, obj in ipairs(workspace:GetDescendants()) do
					if obj:IsA("Model") and table.find(eggNames, obj.Name) then
						pcall(function()
							remote:FireServer(obj)
						end)
					end
				end

				task.wait(0.5)
			end
		end)
	end
end)

-- Noclip
local noclip = false
createButton("Noclip: ปิด", function(btn)
	noclip = not noclip
	btn.Text = "Noclip: " .. (noclip and "เปิด" or "ปิด")
	for _, part in ipairs(player.Character:GetDescendants()) do
		if part:IsA("BasePart") then
			part.CanCollide = not noclip
		end
	end
end)

RunService.Stepped:Connect(function()
	if noclip then
		for _, part in ipairs(player.Character:GetDescendants()) do
			if part:IsA("BasePart") and part.CanCollide then
				part.CanCollide = false
			end
		end
	end
end)

local allDropGui -- GUI ตัวหลัก

createButton("Drop all item", function(btn)
	if allDropGui then
		allDropGui:Destroy()
		allDropGui = nil
		btn.Text = "Drop all item"
	else
		local screenGui = Instance.new("ScreenGui")
		screenGui.Name = "AllDropGui"
		screenGui.ResetOnSpawn = false
		screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

		local button = Instance.new("TextButton")
		button.Name = "AllDropButton"
		button.Size = UDim2.new(0, 50, 0, 50)
		button.Position = UDim2.new(0, 10, 0.5, -25) -- เริ่มต้นที่ซ้ายมือ
		button.Text = "ALL"
		button.TextColor3 = Color3.new(1, 1, 1)
		button.TextSize = 18
		button.Font = Enum.Font.SourceSansBold
		button.BackgroundColor3 = Color3.fromRGB(255, 50, 50) -- สีแดง
		button.BorderSizePixel = 0
		button.AutoButtonColor = true
		button.Parent = screenGui

		local corner = Instance.new("UICorner")
		corner.CornerRadius = UDim.new(1, 0)
		corner.Parent = button

		local dragging = false
		local dragStart, startPos

		local function update(input)
			local delta = input.Position - dragStart
			button.Position = UDim2.new(
				0, startPos.X.Offset + delta.X,
				0, startPos.Y.Offset + delta.Y
			)
		end

		button.InputBegan:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
				dragging = true
				dragStart = input.Position
				startPos = button.Position
				input.Changed:Connect(function()
					if input.UserInputState == Enum.UserInputState.End then
						dragging = false
					end
				end)
			end
		end)

		game:GetService("UserInputService").InputChanged:Connect(function(input)
			if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
				update(input)
			end
		end)

		button.MouseButton1Click:Connect(function()
			for i = 1, 16 do
				game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("DropItem"):FireServer()
			end
		end)

		allDropGui = screenGui
		btn.Text = "Drop all item (ซ่อน)"
	end
end)

-- ปลดล็อคกล้อง
createButton("ปลดล็อคกล้อง", function()
	if player.CameraMode == Enum.CameraMode.LockFirstPerson then
		player.CameraMode = Enum.CameraMode.Classic
	end
end)

-- MouseWheel Zoom
local zoomValue = 0
local zoomStep = 5
local minFOV = 40
local maxFOV = 120

userInput = game:GetService("UserInputService")
userInput.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseWheel then
		local newFov = Camera.FieldOfView - (input.Position.Z * zoomStep)
		Camera.FieldOfView = math.clamp(newFov, minFOV, maxFOV)
	end
end)

-- Toggle Menu
local menuOpen = false
toggleButton.MouseButton1Click:Connect(function()
	menuOpen = not menuOpen
	mainFrame:TweenPosition(
		menuOpen and UDim2.new(0, 0, 0, 0) or UDim2.new(0, -300, 0, 0),
		"Out", "Quad", 0.3, true
	)
end)

-- === New Section for HACK FLY ===
createSectionHeader("HACK FLY")
createButton("ลอยได้", function()
	-- รันสคริปต์ Fly
	loadstring(game:HttpGet("https://raw.githubusercontent.com/AmareScripts/DeadRails/refs/heads/main/FlyV2%25viaTurret.lua"))()
end)

-- === ESP Section ===
createSectionHeader("ESP Section")
local eggHighlights = {}
local npcHighlights = {}
local espEnabled = false
local espPlayerNpcEnabled = false
local colorShift = 0
local player = game.Players.LocalPlayer
local Players = game:GetService("Players")
local workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

-- === ตรวจสอบว่าเป็น Egg ไหม ===
local function isValidEgg(obj)
	return obj:IsA("BasePart") and obj.Name == "Egg"
end

-- === เพิ่ม Highlight ให้ Egg ===
local function addEggESP(egg)
	if not eggHighlights[egg] then
		local hl = Instance.new("Highlight")
		hl.Adornee = egg
		hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
		hl.FillTransparency = 0.25
		hl.OutlineTransparency = 0
		hl.Parent = egg
		eggHighlights[egg] = hl
	end
end

-- === ลบ Highlight ของ Egg ===
local function removeEggESP(egg)
	if eggHighlights[egg] then
		eggHighlights[egg]:Destroy()
		eggHighlights[egg] = nil
	end
end

-- === เพิ่ม Highlight ให้ NPC/Player ===
local function addHighlight(model, fillColor)
	if not npcHighlights[model] and model:FindFirstChildOfClass("Humanoid") then
		local hl = Instance.new("Highlight")
		hl.Adornee = model
		hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
		hl.FillColor = fillColor
		hl.OutlineColor = Color3.new(1, 1, 1)
		hl.FillTransparency = 0.2
		hl.OutlineTransparency = 0
		hl.Parent = model
		npcHighlights[model] = hl
	end
end

-- === ลบ Highlight ของ NPC/Player ===
local function removeHighlight(model)
	if npcHighlights[model] then
		npcHighlights[model]:Destroy()
		npcHighlights[model] = nil
	end
end

-- === ตรวจจับสิ่งใหม่ใน Workspace ===
workspace.DescendantAdded:Connect(function(obj)
	if espEnabled and isValidEgg(obj) then
		addEggESP(obj)
	end

	if espPlayerNpcEnabled and obj:IsA("Model") then
		task.delay(0.1, function()
			if obj:IsDescendantOf(workspace) and obj:FindFirstChildOfClass("Humanoid") then
				local isPlayer = Players:GetPlayerFromCharacter(obj)
				if isPlayer and isPlayer ~= player then
					addHighlight(obj, Color3.fromRGB(0, 255, 0))
				elseif not isPlayer then
					addHighlight(obj, Color3.fromRGB(255, 0, 0))
				end
			end
		end)
	end
end)

-- === ตรวจสอบการหายไปของ Egg/NPC ===
RunService.Heartbeat:Connect(function()
	for egg, hl in pairs(eggHighlights) do
		if not egg or not egg:IsDescendantOf(workspace) then
			removeEggESP(egg)
		end
	end

	for model, hl in pairs(npcHighlights) do
		if not model:IsDescendantOf(workspace) or not model:FindFirstChildOfClass("Humanoid") then
			removeHighlight(model)
		end
	end
end)

-- === สีรุ้งให้ Egg ===
RunService.RenderStepped:Connect(function()
	if espEnabled then
		colorShift = (colorShift + 1) % 360
		local hue = colorShift / 360
		local color = Color3.fromHSV(hue, 1, 1)

		for _, hl in pairs(eggHighlights) do
			if hl then
				hl.FillColor = color
				hl.OutlineColor = Color3.new(1, 1, 1)
			end
		end
	end
end)

-- === ตรวจสอบ PLAYER/NPC ทุกเฟรมแบบละเอียด ===
RunService.RenderStepped:Connect(function()
	if espPlayerNpcEnabled then
		for _, model in ipairs(workspace:GetDescendants()) do
			if model:IsA("Model") and model:FindFirstChildOfClass("Humanoid") and not npcHighlights[model] then
				local isPlayer = Players:GetPlayerFromCharacter(model)
				if isPlayer and isPlayer ~= player then
					addHighlight(model, Color3.fromRGB(0, 255, 0))
				elseif not isPlayer then
					addHighlight(model, Color3.fromRGB(255, 0, 0))
				end
			end
		end
	end
end)

-- === ปุ่มสลับ ESP ===
createButton("ESP EGG: ปิด", function(btn)
	espEnabled = not espEnabled
	btn.Text = "ESP EGG: " .. (espEnabled and "เปิด" or "ปิด")

	if not espEnabled then
		for _, hl in pairs(eggHighlights) do
			hl:Destroy()
		end
		eggHighlights = {}
	else
		for _, obj in ipairs(workspace:GetDescendants()) do
			if isValidEgg(obj) then
				addEggESP(obj)
			end
		end
	end
end)

createButton("ESP PLAYER/NPC: ปิด", function(btn)
	espPlayerNpcEnabled = not espPlayerNpcEnabled
	btn.Text = "ESP PLAYER/NPC: " .. (espPlayerNpcEnabled and "เปิด" or "ปิด")

	if not espPlayerNpcEnabled then
		for _, hl in pairs(npcHighlights) do
			hl:Destroy()
		end
		npcHighlights = {}
	else
		for _, plr in ipairs(Players:GetPlayers()) do
			if plr ~= player and plr.Character then
				addHighlight(plr.Character, Color3.fromRGB(0, 255, 0))
			end
		end
		for _, model in ipairs(workspace:GetDescendants()) do
			if model:IsA("Model") and model:FindFirstChildOfClass("Humanoid") and not Players:GetPlayerFromCharacter(model) then
				addHighlight(model, Color3.fromRGB(255, 0, 0))
			end
		end
	end
end)

-- === X-ray Section ===
createSectionHeader("X-ray")

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local xrayEnabled = false
local xrayParts = {}
local xrayDistance = 20
local transparencyValue = 0.5

-- ตรวจว่ามี Highlight อยู่ในพาร์ทหรือเปล่า
local function hasHighlight(part)
	for _, child in ipairs(part:GetChildren()) do
		if child:IsA("Highlight") then
			return true
		end
	end
	return false
end

-- อัปเดต X-ray แบบ real-time
local function updateXray()
	if not xrayEnabled then return end

	local character = LocalPlayer.Character
	if not character then return end
	local root = character:FindFirstChild("HumanoidRootPart")
	if not root then return end

	local newParts = {}

	for _, part in ipairs(workspace:GetDescendants()) do
		if part:IsA("BasePart") and part.Transparency < 1 and not part:IsDescendantOf(character) then
			if not hasHighlight(part) then
				local distance = (part.Position - root.Position).Magnitude
				if distance <= xrayDistance then
					if not xrayParts[part] then
						part.LocalTransparencyModifier = transparencyValue
					end
					newParts[part] = true
				end
			end
		end
	end

	for part in pairs(xrayParts) do
		if not newParts[part] and part:IsDescendantOf(workspace) then
			part.LocalTransparencyModifier = 0
		end
	end

	xrayParts = newParts
end

-- ปุ่ม Toggle X-ray
createButton("X-ray: ปิด", function(btn)
	xrayEnabled = not xrayEnabled
	btn.Text = "X-ray: " .. (xrayEnabled and "เปิด" or "ปิด")

	if not xrayEnabled then
		for part in pairs(xrayParts) do
			if part:IsDescendantOf(workspace) then
				part.LocalTransparencyModifier = 0
			end
		end
		xrayParts = {}
	end
end)

-- อัปเดตทุกเฟรม
RunService.Heartbeat:Connect(function()
	if xrayEnabled then
		updateXray()
	end
end)

-- === TELEPORT DEAD RAILS ===
createSectionHeader("TELEPORT DEAD RAILS")

createButton("ไปหาเกวียน", function()
	loadstring(game:HttpGet("https://raw.githubusercontent.com/ringtaa/tpfarm.github.io/refs/heads/main/tptofarm.lua"))()
end)

createButton("จบเกมส์อย่างสันติ", function()
	loadstring(game:HttpGet("https://raw.githubusercontent.com/ringtaa/newpacifisct/refs/heads/main/newpacifisct.lua"))()
end)

createButton("ธนาคาร", function()
	loadstring(game:HttpGet("https://raw.githubusercontent.com/ringtaa/Tptobank.github.io/refs/heads/main/Banktp.lua"))()
end)

createButton("ไปเมืองร้าง", function()
	loadstring(game:HttpGet('https://raw.githubusercontent.com/ringtaa/sterlingnotifcation.github.io/refs/heads/main/Sterling.lua'))()
end)

createButton("บอสเทสล่า", function()
	loadstring(game:HttpGet('https://raw.githubusercontent.com/ringtaa/tptotesla.github.io/refs/heads/main/Tptotesla.lua'))()
end)

createButton("ไปปราสาทแวมไพร์", function()
	loadstring(game:HttpGet("https://raw.githubusercontent.com/ringtaa/castletpfast.github.io/refs/heads/main/FASTCASTLE.lua"))()
end)

createButton("ไปรังทหาร", function()
	loadstring(game:HttpGet("https://raw.githubusercontent.com/ringtaa/Tpfort.github.io/refs/heads/main/Tpfort.lua"))()
end)

createButton("กลับรถไฟ", function()
	loadstring(game:HttpGet('https://raw.githubusercontent.com/ringtaa/train.github.io/refs/heads/main/train.lua'))()
end)

-- === CREDIT ===
createSectionHeader("CREDIT")

createButton("อยากให้เพิ่มเมนูอะไรมั่งครับ", function()
	local msg = Instance.new("Message")
	msg.Text = "By M4keitup"
	msg.Parent = workspace
	task.delay(3, function()
		msg:Destroy()
	end)
end)

-- === สร้างพื้นลอยฟ้า ===
createSectionHeader("ฟีเจอร์พิเศษ")

local floatingPart = nil
local TweenService = game:GetService("TweenService")

createButton("สร้างพื้นลอยฟ้า", function(btn)
	if floatingPart then
		floatingPart:Destroy()
		floatingPart = nil
		btn.Text = "สร้างพื้นลอยฟ้า"
	else
		local char = player.Character
		if not char or not char:FindFirstChild("HumanoidRootPart") then return end
		local root = char.HumanoidRootPart

		floatingPart = Instance.new("Part")
		floatingPart.Size = Vector3.new(10, 1, 10)
		floatingPart.Anchored = true
		floatingPart.CanCollide = true
		floatingPart.Material = Enum.Material.ForceField
		floatingPart.Transparency = 0.25
		floatingPart.Color = Color3.fromRGB(100, 0, 150)
		floatingPart.Position = root.Position + Vector3.new(0, 6, 0)
		floatingPart.Name = "FloatingPlatform"
		floatingPart.Parent = workspace

		-- Tween ตัวละครไปบนพาร์ท
		local newCFrame = CFrame.new(floatingPart.Position + Vector3.new(0, 3, 0))
		local tweenInfo = TweenInfo.new(0.6, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
		local tween = TweenService:Create(root, tweenInfo, {CFrame = newCFrame})
		tween:Play()

		btn.Text = "ลบพื้นลอยฟ้า"
	end
end)

-- === QUEST Section ===
createSectionHeader("เควส")

-- Unicorn Highlight Effect (Optimized)
local CollectionService = game:GetService("CollectionService")
local RunService = game:GetService("RunService")

local unicornHighlightEnabled = false
local unicornHighlights = {}
local updateInterval = 0.5
local lastUpdate = 0

local function updateUnicornESP()
	if not unicornHighlightEnabled then return end

	-- ลบ Highlight ที่ไม่จำเป็น
	for unicorn, highlight in pairs(unicornHighlights) do
		if not unicorn or not unicorn:IsDescendantOf(game) then
			if highlight then highlight:Destroy() end
			unicornHighlights[unicorn] = nil
		end
	end

	-- เพิ่ม Highlight ให้ Unicorn ที่ยังไม่มี
	for _, obj in ipairs(CollectionService:GetTagged("Unicorn")) do
		if obj:IsA("BasePart") and not unicornHighlights[obj] then
			local highlight = Instance.new("Highlight")
			highlight.Adornee = obj
			highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
			highlight.FillColor = Color3.fromRGB(255, 105, 180)
			highlight.OutlineColor = Color3.fromRGB(255, 105, 180)
			highlight.FillTransparency = 0.25
			highlight.OutlineTransparency = 0
			highlight.Parent = obj
			unicornHighlights[obj] = highlight
		end
	end
end

-- ปุ่ม Toggle Unicorn ESP
createButton("Unicorn ESP: ปิด", function(btn)
	unicornHighlightEnabled = not unicornHighlightEnabled
	btn.Text = "Unicorn ESP: " .. (unicornHighlightEnabled and "เปิด" or "ปิด")

	if not unicornHighlightEnabled then
		for _, highlight in pairs(unicornHighlights) do
			if highlight then highlight:Destroy() end
		end
		unicornHighlights = {}
	end
end)

-- ทำงานทุก 0.5 วินาทีเท่านั้น
RunService.Heartbeat:Connect(function(dt)
	if unicornHighlightEnabled then
		lastUpdate += dt
		if lastUpdate >= updateInterval then
			updateUnicornESP()
			lastUpdate = 0
		end
	end)
end)
